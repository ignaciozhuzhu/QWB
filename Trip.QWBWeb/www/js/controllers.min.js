/*! grunt_test-1.0.0.js 2016-08-02 */
angular.module("starter.controllers",[]).controller("AppCtrl",function(){}).controller("indexCtrl",["$scope","$http",function(a,b){a.bzyc=function(){window.location.href=" #/app/carsearch"},a.jsj=function(){window.location.href=" #/app/air_booking"}}]).controller("carsearchCtrl",["$scope","$http","$ionicScrollDelegate","$compile","getcitysev",function(a,b,c,d,e){function f(a,c,d){var e="../../ajax/apihandler.ashx?fn=getdistances&from_location_id="+a+"&to_location_id="+c;b.get(e).success(function(a){0==a.status?($(".carsearch .citydistancetip")[d-1].className="citydistancetip displayblock",a.distance<400?$(".carsearch .citydistancetip")[d-1].innerText="一天内可以到达":a.distance>=400&&a.distance<600?$(".carsearch .citydistancetip")[d-1].innerText="约"+a.distance+"公里,距离较远,可能会加收费用.":a.distance>600&&($(".carsearch .citydistancetip")[d-1].innerText="约"+a.distance+"公里,距离太远,一天内可能无法抵达.")):$(".carsearch .citydistancetip")[d-1].className="citydistancetip displaynone"})}var g="";a.displaybox=function(a){$(a.target.parentNode.nextElementSibling).css("display","block")},a.displaynonebox=function(a){$(a.target.parentNode.nextElementSibling).css("display","none")},a.solo=function(){$(".carsearch #new1").css("color","#01d4c1"),$(".carsearch #new2").css("color","#b1b1b1"),$(".carsearch .endcartime").css("display","block"),$(".carsearch .carline").css("display","none"),$(".carsearch #buttonadddate").css("display","none"),g=1},a.various=function(){$(".carsearch #new1").css("color","#b1b1b1"),$(".carsearch #new2").css("color","#01d4c1"),$(".carsearch .endcartime").css("display","none"),$(".carsearch .carline").css("display","block"),$(".carsearch #buttonadddate").css("display","block"),g=2},a.clickCity=function(a){c.scrollTo(0,270);var b=a.target.outerHTML.indexOf("model["),d=a.target.outerHTML.substring(b+6,b+7);$(".carsearch .citydistancetip")[d-1].className="citydistancetip displaynone"};a.delday=function(){$(".carlinedetail")[0].lastElementChild.remove()},a.adddate=function(){var b=angular.element(document.createElement("variocities-components"));d(b)(a),$(".carlinedetail").append(b),displaynonecountry()};var h=function(a){i=a},i=e.myFunc(b,a,h);a.change=function(b){for(var c=0;c<i.zones.length;c++)i.zones[c].id==b&&(a.areas=i.zones[c].areas);a.model={wcity:"",wcityid:0},displaynonecountry(".carsearch")},a.changecity=function(){displaynonecountry(".carsearch")},a.selectcity=function(b){a.model={wcity:b.target.innerText,wcityid:b.target.children[0].innerText},a.caridArray="",j(),displaynonecountry(".carsearch");for(var c=0;10>c;c++)$(".carsearch .citydistancetip")[c].innerText=""},a.selectcity2=function(b){var c=b.target.outerHTML.indexOf("model["),d=b.target.outerHTML.substring(c+6,c+7);a.model[d]={wcity:b.target.innerText,wcityid2:b.target.children[0].innerText},a.model.length=parseInt(d)+1,a.caridArray="",j(),displaynonecountry(".carsearch");var e,g;try{e=a.model[d-1].wcityid2,g=a.model[d].wcityid2}catch(h){e=a.model.wcityid,g=a.model[d].wcityid2}f(e,g,d)},a.caridArray="";var j=function(){var c="../../ajax/apihandler.ashx?fn=getairports&city_id="+a.model.wcityid;b.get(c).success(function(c){a.airports=c.airports;var d="../../ajax/apihandler.ashx?fn=getcarslist&locationid="+a.model.wcityid;b.get(d).success(function(b){for(var c=0;c<b.car_categories.length;c++)a.caridArray+=b.car_categories[c].id+"|";a.caridArray=a.caridArray.substr(0,a.caridArray.length-1)})})},k=new Date;k=new Date(k.valueOf()+2592e5),a.currentDate=k,a.minDate=k,a.maxDate=new Date(2017,1,1),a.currentDate2=k,a.minDate2=k,a.maxDate2=new Date(2017,1,1),$(".carsearch .weekdayget")[0].innerText=getmyweekday(k),$(".carsearch .weekdayget")[1].innerText=getmyweekday(k),a.datePickerCallback=function(b){b?(console.log("Selected date is : ",b),$(".carsearch .weekdayget")[0].innerText=getmyweekday(b),a.minDate2=b):console.log("Date not selected")},a.datePickerCallback2=function(b){b?(console.log("Selected date is : ",b),$(".carsearch .weekdayget")[1].innerText=getmyweekday(b),a.maxDate=b):console.log("Date not selected")},a.search=function(){var b,c,d;if(2==g){d=a.model.wcityid;var e,f=$("ionic-datepicker")[0].innerText,h=parserDate(f);c="",b=f;for(var i=1;i<a.model.length;i++)d+="|"+a.model[i].wcityid2,e=1==i?h:parserDate(e),e=FormatDateYear(new Date(e.valueOf()+864e5)),b+="|"+e}else b=$("ionic-datepicker")[0].innerText.trim(),c=$("ionic-datepicker")[1].innerText.trim(),d=a.model.wcityid;return a.model.wcity?b>c&&1==g?void layermyui("开始时间不能晚于结束时间"):void(window.location.href="#/app/carlist2/"+a.model.wcity+"/"+a.caridArray+"/"+b+"/"+c+"/"+d):void layermyui("请选择城市")}}]).controller("air_bookingCtrl",["$scope","$http","$ionicScrollDelegate","getcitysev",function(a,b,c,d){a.displaybox=function(a){$(a.target.parentNode.nextElementSibling).css("display","block")},a.displaynonebox=function(a){$(a.target.parentNode.nextElementSibling).css("display","none")};var e=1;a.clickCity=function(){c.scrollTo(0,230)},a.pick=function(){$(".air_booking .pickcity")[0].innerText="降落城市",$(".air_booking .pickairport")[0].innerText="降落机场",$(".air_booking .pickdate")[0].innerText="接机日期",$(".air_booking .pickaddress")[0].innerText="送达地点",$(".air_booking #new1").css("color","#01d4c1"),$(".air_booking #new2").css("color","#b1b1b1"),e=1},a.send=function(){$(".air_booking .pickcity")[0].innerText="出发城市",$(".air_booking .pickairport")[0].innerText="出发机场",$(".air_booking .pickdate")[0].innerText="上车日期",$(".air_booking .pickaddress")[0].innerText="上车地点",$(".air_booking #new1").css("color","#b1b1b1"),$(".air_booking #new2").css("color","#01d4c1"),e=2};var f=function(a){g=a},g=d.myFunc(b,a,f);a.change=function(b){for(var c=0;c<g.zones.length;c++)g.zones[c].id==b&&(a.areas=g.zones[c].areas);a.model={wcity:"",wcityid:0},a.model2={airports:"",airportsid:0,airportscode:"",airportname:""},a.model3={endaddress:""},$(".air_booking #inputendaddress")[0].value="",displaynonecountry(".air_booking")},a.changecity=function(){displaynonecountry(".air_booking")},a.selectcity=function(b){a.model={wcity:b.target.innerText,wcityid:b.target.children[0].innerText},a.caridArray="",h(),a.model2={airports:"",airportsid:0,airportscode:"",airportname:""},a.model3={endaddress:""},$(".air_booking #inputendaddress")[0].value="",a.endaddress="",displaynonecountry(".air_booking")},a.caridArray="";var h=function(){var c="../../ajax/apihandler.ashx?fn=getairports&city_id="+a.model.wcityid;b.get(c).success(function(c){if(c.airports.length>0){a.airports=c.airports;var d="../../ajax/apihandler.ashx?fn=getcarslist&locationid="+a.model.wcityid;b.get(d).success(function(b){for(var c=0;c<b.car_categories.length;c++)a.caridArray+=b.car_categories[c].id+"|";a.caridArray=a.caridArray.substr(0,a.caridArray.length-1)})}else layermyui("该城市未开通机场")})};a.selectairport=function(b){a.model2={airports:b.target.innerText,airportsid:b.target.children[0].innerText,airportscode:b.target.children[1].innerText,airportname:b.target.children[2].innerText}},a.changeaddress=function(c){var d=c;if(a.model2.airportscode)try{var e="../../ajax/apihandler.ashx?fn=getairbookingsaddrs&airport_code="+a.model2.airportscode+"&query="+d;b.get(e).success(function(b){a.endaddress=b.results})}catch(f){}},a.selectaddress2=function(b){a.model3={endaddress:b.target.innerText},$(".air_booking #inputendaddress")[0].value=b.target.innerText};var i=new Date;i=new Date(i.valueOf()+2592e5),a.currentDate=i,a.minDate=new Date,a.maxDate=new Date(2017,1,1),$(".air_booking .weekdayget")[0].innerText=getmyweekday(i),a.datePickerCallback=function(a){a&&($(".air_booking .weekdayget")[0].innerText=getmyweekday(a))},a.downsome=function(){c.scrollTo(0,310)},a.search=function(){if(!a.model2.airports)return void layermyui("请选择机场");if(!a.model3.endaddress)return void layermyui("请选择地点");var b=$("ionic-datepicker")[0].innerText;window.location.href="#/app/carlist/"+e+"/"+a.model2.airportname+"/"+a.caridArray+"/"+a.model2.airportscode+"/"+b+"/"+a.model3.endaddress+"/"+a.model.wcityid}}]).controller("carlistCtrl",["$scope","$http","$ionicScrollDelegate",function(a,b,c){$(".carlisthrefback").attr("href","#/app/air_booking");var d=getpbyurl(7),e=decodeURI(getpbyurl(6)),f=decodeURI(getpbyurl(5)),g=decodeURI(getpbyurl(4)),h=decodeURI(getpbyurl(3)),i=decodeURI(getpbyurl(2)),j=decodeURI(getpbyurl(1)),k="../../ajax/apihandler.ashx?fn=getair_bookingsnew&car_category_id="+f+"&pickup_airport_code="+g+"&pickup_flight=&pickup_time="+h+"&pickup_addr="+i+"&locationid="+j,l=layer.load(1,{shade:[.5,"#ababab"]});b.get(k).success(function(b){layer.close(l),null==b.list?$(".carlist .smalltips").append("很抱歉,该地目前未有车型推荐!"):(a.group=uniqueObject(b),a.car_categories=b.list)}),a.ordernow=function(a){var b=a.target.previousElementSibling,c=b.innerText,f=b.previousElementSibling.innerText,k=b.previousElementSibling.previousElementSibling.innerText,l=b.previousElementSibling.previousElementSibling.previousElementSibling.innerText,m=b.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerText;window.location.href="#/app/air_service/"+j+"/"+d+"/"+e+"/"+m+"/"+l+"/"+k+"/"+c+"/"+f+"/"+g+"/"+h+"/"+i},a.toogledown=function(a){var b=a.target.parentElement.parentElement.parentElement.nextSibling.nextSibling;"panel-collapse collapse"==b.className&&($(b).slideToggle(),$(".collapse").css({visibility:"visible"}),c.resize())}}]).controller("carlist2Ctrl",["$scope","$http","$ionicScrollDelegate",function(a,b,c){$(".carlisthrefback").attr("href","#/app/carsearch");var d=decodeURI(getpbyurl(5)),e=decodeURI(getpbyurl(4)),f=decodeURI(getpbyurl(3)),g=decodeURI(getpbyurl(2)),h=getpbyurl(1),i="../../ajax/apihandler.ashx?fn=getbookingsnew&car_category_id="+e+"&pickup_time1="+f+"&pickup_time2="+g+"&locationid="+h,j=layer.load(1,{shade:[.5,"#ababab"]});b.get(i).success(function(b){layer.close(j),null==b.list?$(".carlist .smalltips").append("很抱歉,该地目前未有车型推荐!"):(a.group=uniqueObject(b),a.car_categories=b.list)}).error(function(a,b){console.log(a)}),a.ordernow=function(a){var b=a.target.previousElementSibling,c=b.innerText,e=(b.previousElementSibling.innerText,b.previousElementSibling.previousElementSibling.innerText),i=b.previousElementSibling.previousElementSibling.previousElementSibling.innerText,j=b.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerText,k=b.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerText;window.location.href="#/app/car_service/"+k+"/"+d+"/"+h+"/"+j+"/"+i+"/"+e+"/"+c+"/"+f+"/"+g},a.toogledown=function(a){var b=a.target.parentElement.parentElement.parentElement.nextSibling.nextSibling;"panel-collapse collapse"==b.className&&($(b).slideToggle(),$(".collapse").css({visibility:"visible"}),c.resize())}}]).controller("air_serviceCtrl",["$scope","$http","hexafy",function(a,b,c){var d=decodeURI(getpbyurl(1)),e=decodeURI(getpbyurl(2)),f=getpbyurl(3),g=getpbyurl(4),h=getpbyurl(5),i=decodeURI(getpbyurl(6)),j=decodeURI(getpbyurl(7)),k=decodeURI(getpbyurl(8)),l=decodeURI(getpbyurl(9)),m=getpbyurl(10),n=getpbyurl(11);1==m?($(".air_service .pickosendplane")[0].innerText="降落机场",$(".air_service .pickosendaddress")[0].innerText="目的地"):2==m&&($(".air_service .pickosendplane")[0].innerText="到达机场",$(".air_service .pickosendaddress")[0].innerText="出发地"),a.driver_category_name=i,a.car_name=j,a.car_brand=k,a.airportname=l,a.endaddress=d,a.pickprice=g;var o,p=g;a.$on("$ionicView.loaded",function(){var d=function(a){o=a,$(".air_service .spinnercd").myspinner({max:o}),$(".air_service .spinnerad").myspinner({max:o,min:1})};c.myFunc(n,b,a,h,d),$(function(){var a=(new Date).getFullYear(),b={date:{preset:"date",dateOrder:"d Dmmyy",invalid:{daysOfWeek:[0,6],daysOfMonth:["5/1","12/24","12/25"]}},datetime:{preset:"datetime",minDate:new Date(2012,3,10,9,22),maxDate:new Date(2014,7,30,15,44),stepMinute:5},time:{preset:"time"},credit:{preset:"date",dateOrder:"mmyy",dateFormat:"mm/yy",startYear:a,endYear:a+10,width:100},select:{preset:"select"},"select-opt":{preset:"select",group:!0,width:50}};$(".settings select").bind("change",function(){var a="time";a.match(/select/i)||$(".demo-test-"+a).val(""),$(".demo-test-"+a).scroller("destroy").scroller($.extend(b[a],{lang:"zh"})),$(".demo").hide(),$(".demo-"+a).show()}),$("#demo").trigger("change")})});var q=parserDate(e);a.currentDate=q,a.minDate=new Date,a.maxDate=new Date(2017,1,1),$(".air_service .weekdayget")[0].innerText=getmyweekday(q),a.datePickerCallback=function(a){a?(console.log("Selected date is : ",a),$(".air_service .weekdayget")[0].innerText=getmyweekday(a)):console.log("Date not selected")};var r=1,s=0;$(".air_service #sp01").click(function(){s=this.children[0].children[1].value,maxpassenger(".air_service #sp01",".air_service #sp02",r,s,o)}),$(".air_service #sp02").click(function(){r=this.children[0].children[1].value,maxpassenger(".air_service #sp01",".air_service #sp02",r,s,o)}),a.createorder=function(){var a="",c="http://test.haihuilai.com/apis/qwb/v1/air_bookings/create",e=getCookie("shopid4QWB");e||(e=55);var g=getCookie("custid4QWB"),i=getCookie("guideid4QWB"),j="";g?j=',"customer_id":'+g:i&&(j=',"guide_id":'+i);var k=h,l=f,m=$(".air_service #pickupFlightNo")[0].value,n=$(".air_service #pickupTime")[0].value,o=$("ionic-datepicker")[0].innerText.substr(0,$("ionic-datepicker")[0].innerText.length-4).trim();n&&(o+=" "+n);for(var q=d,t="[",u=1;s>=u;u++)t+="10,";t=t.substr(0,t.length-1),t+="]";var v=$(".air_service #contactName")[0].value,w=$(".air_service #contactPassport")[0].value,x=$(".air_service #contactPhone")[0].value,y='{"name":"'+v+'","passport":"'+w+'","mobile":"'+x+'"}',z=$(".air_service #memo")[0].value,A="qwb_1467082083",B="3b1b7113028cc5eeefa5cc61f4872827";if(""==m)return void layermyui("请输入航班号!");if(""==v)return void layermyui("请输入联系人姓名!");if(""==w)return void layermyui("请输入联系人证件号!");if(""==x)return void layermyui("请输入联系电话!");a='{"api_url":"'+c+'","shop_id":'+e+j+',"order":{"car_category_id":'+k+',"pickup_airport_code":"'+l+'","pickup_flight":"'+m+'","pickup_time":"'+o+'","pickup_addr":"'+q+'","adults":'+r+',"traveller":'+y+',"memo":"'+z+'","key":"'+A+'","sign":"'+B+'","total_price":"'+p+'"}}';var C="../../ajax/apihandler.ashx?fn=createordertg&json="+a,D=layer.load(1,{shade:[.5,"#ababab"]});b.get(C).success(function(a){if(layer.close(D),0!=a.code)return void layermyui("下单失败!"+a.message);a.data.order_no,a.data.vendor_order_no;layermyui("下单成功!将为您自动跳转..."),setTimeout('window.location.href = "'+a.data.pay_url+'"',2e3)})}}]).controller("car_serviceCtrl",["$scope","$http","hexafy",function(a,b,c){function d(){var c="../../ajax/apihandler.ashx?fn=getbookingsnewp1&from_date="+i+"&from_location_id="+n+"&to_date="+h+"&car_category_id="+j+"&driver_category_id="+p+"&adults="+t+"&kids="+u+"&kids_age=0",d=layer.load(1,{shade:[.5,"#ababab"]});b.get(c).success(function(b){layer.close(d),a.price=b.price,a.food_fee=b.food_fee,a.room_fee=b.room_fee,a.tips=b.tips,a.total_price=b.total_price})}var e,f,g,h=decodeURI(getpbyurl(1)).trim(),i=decodeURI(getpbyurl(2)).trim(),j=decodeURI(getpbyurl(3)),k=decodeURI(getpbyurl(4)),l=decodeURI(getpbyurl(5)),m=decodeURI(getpbyurl(6)),n=decodeURI(getpbyurl(7)),o=decodeURI(getpbyurl(8)),p=decodeURI(getpbyurl(9));if(""==h){f=i.split("|"),g=n.split("|");var q=i.substring(0,i.indexOf("|")).trim(),r=i.substring(i.lastIndexOf("|")+1);e=diffDateBy2days(q,r),a.date1=q,a.date2=r}else e=diffDateBy2days(i,h),a.date1=i,a.date2=h;a.driver_category_name=k,a.car_name=l,a.car_brand=m;var s;a.$on("$ionicView.loaded",function(){var d=function(a){s=a,$(".car_service .spinnercd").myspinner({max:s}),$(".car_service .spinnerad").myspinner({max:s,min:1})};c.myFunc(n,b,a,j,d)}),a.cityname=o,a.cityid=n,a.daysdiff=e;var t=1,u=0;$(".car_service #sp01").click(function(){u=this.children[0].children[1].value,d(),maxpassenger(".car_service #sp01",".car_service #sp02",t,u,s)}),$(".car_service #sp02").click(function(){t=this.children[0].children[1].value,d(),maxpassenger(".car_service #sp01",".car_service #sp02",t,u,s)}),d(),a.createorder=function(){var c="",d="http://test.haihuilai.com/apis/qwb/v1/bookings/create",k=getCookie("shopid4QWB");k||(k=55);var l=getCookie("custid4QWB"),m=getCookie("guideid4QWB"),o="";l?o=',"customer_id":'+l:m&&(o=',"guide_id":'+m);var q=i,r=n,s=h,v=j,w=a.total_price,x="";if(""==s){var y=i.substring(0,i.indexOf("|")).trim(),z=i.substring(i.lastIndexOf("|")+1);q=y,s=z,x+='{"location_id":'+g[0]+',"days":1},';for(var A=1;A<f.length;A++)x+='{"location_id":'+g[A]+',"days":'+diffDateBy2days2(f[parseInt(A)-1],f[A])+"},";x=x.substr(0,x.length-1),r=g[0]}else x='{"location_id":'+r+',"days":'+e+"}";var B="";if(u>0){B=',"kids":'+u+',"kids_age":',B+="[";for(var C=1;u>=C;C++)B+="10,";B=B.substr(0,B.length-1),B+="]"}var D=$(".car_service #contactName")[0].value,E=$(".car_service #contactPassport")[0].value,F=$(".car_service #contactPhone")[0].value,G='{"name":"'+D+'","passport":"'+E+'","mobile":"'+F+'"}',H="qwb_1467082083",I="3b1b7113028cc5eeefa5cc61f4872827";if(""==D)return void layermyui("请输入联系人姓名!");if(""==E)return void layermyui("请输入联系人证件号!");if(""==F)return void layermyui("请输入联系电话!");c='{"api_url":"'+d+'","shop_id":'+k+o+',"order":{"from_date":"'+q+'","from_location_id":"'+r+'","to_date":"'+s+'","car_category_id":'+v+',"driver_category_id":"'+p+'","adults":'+t+B+',"traveller":'+G+',"travel_items":['+x+'],"key":"'+H+'","sign":"'+I+'","total_price":"'+w+'"}}';var J="../../ajax/apihandler.ashx?fn=createcarordertg&json="+c,K=layer.load(1,{shade:[.5,"#ababab"]});b.get(J).success(function(a){if(layer.close(K),0!=a.code)return void layermyui("下单失败!"+a.message);a.data.order_no,a.data.vendor_order_no;layermyui("下单成功!将为您自动跳转..."),setTimeout('window.location.href = "'+a.data.pay_url+'"',2e3)})}}]);